spring:
  application:
    name: api-gateway
  cloud:
    gateway:
      routes:
        # Product Service Routes
        - id: product-service
          uri: ${PRODUCT_SERVICE_URL:http://localhost:8081}
          predicates:
            - Path=/api/products/**
          filters:
            - name: CircuitBreaker
              args:
                name: productCircuitBreaker
                fallbackUri: forward:/fallback/products

        # Order Service Routes
        - id: order-service
          uri: ${ORDER_SERVICE_URL:http://localhost:8082}
          predicates:
            - Path=/api/orders/**
          filters:
            - name: CircuitBreaker
              args:
                name: orderCircuitBreaker
                fallbackUri: forward:/fallback/orders

        # Product Service Swagger
        - id: product-swagger
          uri: ${PRODUCT_SERVICE_URL:http://localhost:8081}
          predicates:
            - Path=/product-docs/**
          filters:
            - RewritePath=/product-docs/(?<path>.*), /${path}

        # Order Service Swagger
        - id: order-swagger
          uri: ${ORDER_SERVICE_URL:http://localhost:8082}
          predicates:
            - Path=/order-docs/**
          filters:
            - RewritePath=/order-docs/(?<path>.*), /${path}

      # Global CORS configuration
      globalcors:
        corsConfigurations:
          '[/**]':
            allowedOrigins: "*"
            allowedMethods:
              - GET
              - POST
              - PUT
              - DELETE
              - PATCH
              - OPTIONS
            allowedHeaders: "*"

server:
  port: ${PORT:8080}

management:
  endpoints:
    web:
      exposure:
        include: health,info,gateway
  endpoint:
    health:
      show-details: always
    gateway:
      enabled: true

logging:
  level:
    org.springframework.cloud.gateway: INFO
